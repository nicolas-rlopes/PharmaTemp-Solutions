<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Inicial</title>
    <link rel="stylesheet" href="estilo.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../js/alerta.js"></script>
    <link rel="icon" href="G03-removebg-preview.png" type="image/x-icon">
</head>

<body onload="setInterval(obterdados(sessionStorage.SENSOR), 1000);">
    <div class="conteudo">
        <div class="guia">
            <div class="nome">
                <img src="imagens/Fernando-Brandao.png" alt="Foto de identificação de usuario">
                <h1><span id="b_usuario">usuário</span></h1>
            </div>
            <div class="info">
                <ul class="bar">
                    <li class="aqui"><a href="dash.html">Menu</a></li>
                    <li><a href="atencao.html">Dashboard</a></li>
                    <li><a href="contato.html">Entrar em contato</a></li>
                    <button onclick="voltar()"><span class="fa fa-sign-out"></span>Sair
                </ul>
            </div>
        </div>
        <div class="menu">

            <div class="descricao">
                <div class="dash">
                    <div id="alerta">
                    </div>
                    <div class="area-parametros-alerta">
                        <p class="titulo-legenda">
                            Parâmetros para Alertas
                        </p>
                        <div class="parametros-alerta">
                            <div class="item-regua perigo-frio">
                                <p>Perigo</p>
                                <p>&lt;=-2°C</p>
                            </div>
                            <div class="item-regua alerta-frio">
                                <p>Alerta</p>
                                <p>&lt;=1°C</p>
                            </div>
                            <div class="item-regua ideal">
                                <p>Ideal</p>
                                <p>5°C</p>
                            </div>
                            <div class="item-regua alerta-quente">
                                <p>Alerta</p>
                                <p>&gt;=9°C</p>
                            </div>
                            <div class="item-regua perigo-quente">
                                <p>Perigo</p>
                                <p>&gt;=11°C</p>
                            </div>
                        </div>
                    </div>

                    <div class="cards" id="cardAquarios">

                    </div>

                </div>
            </div>

            <div class="cont">

                <div class="graficoMenu">
                    <h3>Situações das Geladeiras</h3>
                    <canvas id="myChart3" style="position: relative; width:100px "></canvas>
                </div>

            </div>
        </div>
    </div>
</body>

<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    function voltar() {
        window.location.href = '../login.html'
    }

    var total = 3;
    var critica = 1;
    var atencao = 1;
    var normal = total - critica - atencao;

    const labels3 = [
        'Situação Normal',
        'Em Atenção',
        'Situação Crítica',
    ];

    const data3 = {
        labels: labels3,
        datasets: [{
            label: 'Situação normal',
            backgroundColor: ['rgb(50 , 255, 40)', 'rgb(255, 255, 40)', 'rgb(255, 40, 40)'],
            borderColor: 'white',
            data: [normal, atencao, critica]
        }
        ]
    };

    const config3 = {
        type: 'pie',
        data: data3,
        options: {}
    };

    // SEGUNDA KPI BARRA

    const labels1 = [
        '08/01/2024',
        '08/02/2024',
        '08/03/2024',
        '08/04/2024',
        '08/05/2024',
        '08/06/2024',
        '08/07/2024',
    ];

    const data1 = {
        labels: labels1,
        datasets: [{
            label: 'Problema',
            backgroundColor: 'rgb(92, 162, 242)',
            borderColor: 'white',
            data: [1, 1, 2, 4, 3, 6, 9],

        },
        {
            label: 'Adquiridos',
            backgroundColor: 'rgb(6, 65, 134)',
            borderColor: 'white',
            data: [4, 7, 9, 10, 12, 14, 18],
        }
        ]
    };

    const config1 = {
        type: 'bar',
        data: data1,
        options: {}
    };

    // TERCEIRA KPI PERDA


    const labels2 = [
        '25/04/2024',
        '25/05/2024',
        '25/06/2024',
        '25/07/2024',
        '25/08/2024',
        '25/09/2024',
        '25/10/2024',
    ];

    const data2 = {
        labels: labels2,
        datasets: [{
            label: 'Temperatura Crítica',
            backgroundColor: 'rgb(255, 40, 40)',
            borderColor: 'rgb(255, 40, 40)',
            data: [7, 16, 10, 21, 38, 24, 30]
        }
        ]
    };

    const config2 = {
        type: 'bar',
        data: data2,
        options: {}
    };

    const myChart3 = new Chart(
        document.getElementById('myChart3'),
        config3
    )

    const myChart1 = new Chart(
        document.getElementById('myChart1'),
        config1
    )

    const myChart2 = new Chart(
        document.getElementById('myChart2'),
        config2
    )
    function mostrarAlertas() {
        fetch("/medidas/pegarAlertas", {
            method: "post",
            headers:{
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                email: sessionStorage.EMAIL_USUARIO
            })
        }).then((resposta) => {
            // console.log(resposta);
            if (resposta.ok) {
                resposta.json().then(dados => {

                    // console.log(`Dados recebidos: ${JSON.stringify(dados)}`);

                    alertar(dados, sessionStorage.SENSOR)
                });
            }
        }).catch((erro) => {
            console.log("Erro ao pegar os alertas", erro);
        });
    }
</script>

</html>